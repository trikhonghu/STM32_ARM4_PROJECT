/*
 * fsm.c
 *
 *  Created on: Nov 28, 2023
 *      Author: Admin
 */


#include "fsm.h"

int status = INIT;
int ID = 0;
int mode = EASY;
int speed = 1000;
int check_sent;

void fsm_mode(){
	switch(mode){
	case EASY:
		speed = 1000;
		break;
	case AVERAGE:
		speed = 100;
		break;
	case HARD:
		speed = 10;
		break;
	}
}

void fsm_machine(){
	switch (status) {
	case INIT:
		screen_init();
		if(button_count[0] == 1){
			ID = ID*10 + 1;
		}
		if(isButtonStart()){
			status = PLAY;
			lcd_Clear(BLACK);
			re_init();
			screen_play();
			fsm_mode();
		}
		break;
	case PLAY:
		if(isButtonUp()){
			sw_up = 0;
			sw_down = 1;
			sw_left = 1;
			sw_right = 1;
			flag_timer3 = 1;
		}
		if(isButtonDown()){
			sw_up = 1;
			sw_down = 0;
			sw_left = 1;
			sw_right = 1;
			flag_timer3 = 1;
		}
		if(isButtonLeft()){
			sw_up = 1;
			sw_down = 1;
			sw_left = 0;
			sw_right = 1;
			flag_timer3 = 1;
		}
		if(isButtonRight()){
			sw_up = 1;
			sw_down = 1;
			sw_left = 1;
			sw_right = 0;
			flag_timer3 = 1;
		}
		//wait_check();
		if(flag_timer3 == 1){
			wait_check();
			setTimer3(speed);
			update_grid();
			check_food();
			move_snake();
			check_collision();
			screen_score();
		}
		if(lose == 1){
			status = GAME_OVER;
			lcd_Clear(BLACK);
			lose = 0;
			screen_game_over();
		}
		break;
	case GAME_OVER:
		if(isButtonRestart()){
			status = INIT;
			lcd_Clear(BLACK);
			re_init();
		}
		break;
	default:
		break;
	}
}


